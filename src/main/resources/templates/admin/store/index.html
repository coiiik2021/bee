<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{/admin/template}">
<head>
    <meta charset="UTF-8">
    <title>Bán hàng tại quầy</title>
    <link rel="stylesheet" href="/admin/store/style.css">
</head>

<body>

<main class="content px-3 py-4" layout:fragment="main">
    <div class="container-fluid">
        <div class="row">
            <!-- Nội dung trang chính ở bên trái (nếu có) -->
            <div class="col-md-9">
                <div class="card text-center">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <ul class="nav nav-pills card-header-pills" id="navPills">
                            <li class="hoa-don nav-item" th:each="invoice,stt : ${listInvoice}">
                                <a th:href="@{/admin/store/invoice-detail/{id}(id=${invoice.id})}"
                                   th:classappend="${invoice.id == activeInvoiceId} ? 'active'"
                                   class="hoa-don-link nav-link">
                                    Hoá đơn [[${stt.index + 1}]]
                                </a>
                                <a href="#" th:onclick="'confirmDelete(event, ' + ${invoice.id} + ')'">
                                    <button type="button" class="nut-close btn-close" aria-label="Close"></button>
                                </a>
                            </li>
                        </ul>
                        <!-- Button to add new Nav item inside nav -->
                        <form id="invoiceForm" th:action="@{/admin/store/add-invoice}" method="post" th:object="${i}">
                            <button id="showToastButton" type="button" class="btn btn-success">Thêm hoá đơn</button>
                        </form>
                    </div>
                    <div class="card-body">
                        <div class="mb-3 d-flex justify-content-between">
                            <div class="d-flex">
                                <div class="d-flex align-items-center">
                                    <input type="text" class="form-control flex-grow-1"
                                           placeholder="Tìm kiếm sản phẩm">
                                    <button type="button" class="btn btn-primary ms-2" data-bs-toggle="modal"
                                            data-bs-target="#productModal">+
                                    </button>
                                    <!-- Modal -->
                                    <div class="modal fade" id="productModal" tabindex="-1"
                                         aria-labelledby="productModalLabel" aria-hidden="true">
                                        <div class="modal-dialog modal-xl">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title" id="productModalLabel">Danh sách sản
                                                        phẩm</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                            aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <table class="table">
                                                        <thead>
                                                        <tr>
                                                            <th>STT</th>
                                                            <th>Ảnh</th>
                                                            <th>SKU</th>
                                                            <th>Tên sản phẩm</th>
                                                            <th>Kích cỡ</th>
                                                            <th>Màu sắc</th>
                                                            <th>Chất liệu</th>
                                                            <th>Danh mục</th>
                                                            <th>Vải lót</th>
                                                            <th>Đai mũ</th>
                                                            <th>Kiểu dáng</th>
                                                            <th>Số lượng</th>
                                                            <th>Hành động</th>
                                                        </tr>
                                                        </thead>
                                                        <tbody>
                                                        <!-- Lặp qua danh sách productDetail -->
                                                        <tr th:each="detail, stt : ${productDetails.content}">
                                                            <td>[[${stt.index +1}]]</td>
                                                            <td th:if="${detail.product.images.size() > 0}">
                                                                <img th:src="${detail.product.images[0].imageUrl}"
                                                                     alt="Ảnh sản phẩm"
                                                                     style="width: 100px; height: auto;"/>
                                                            </td>
                                                            <td th:if="${detail.product.images.size() <= 0}">
                                                                <img src="" alt="Ảnh mặc định"
                                                                     style="width: 100px; height: auto;"/>
                                                            </td>
                                                            <td>[[${detail.product.sku}]]</td>
                                                            <td>[[${detail.product.name}]]</td>
                                                            <td>[[${detail.size.name}]]</td>
                                                            <td>[[${detail.color.name}]]</td>
                                                            <td>[[${detail.product.material.name}]]</td>
                                                            <td>[[${detail.product.category.name}]]</td>
                                                            <td>[[${detail.product.lining.name}]]</td>
                                                            <td>[[${detail.product.belt.name}]]</td>
                                                            <td>[[${detail.product.style.name}]]</td>
                                                            <td>[[${detail.stock}]]</td>
                                                            <td colspan="2">
                                                                <form method="post">
                                                                    <input type="hidden"
                                                                           th:name="${_csrf.parameterName}"
                                                                           th:value="${_csrf.token}"/>
                                                                    <input th:value="${invoiceId}" name="invoiceId"
                                                                           hidden="hidden">
                                                                    <input th:value="${detail.id}"
                                                                           name="productDetailId" hidden="hidden">
                                                                    <button th:formaction="@{/admin/store/add-product-detail-to-invoice}"
                                                                            class="btn btn-primary" type="submit">Thêm
                                                                        vào giỏ
                                                                    </button>
                                                                </form>
                                                            </td>
                                                        </tr>
                                                        </tbody>
                                                    </table>
                                                    <!-- Hiển thị nút phân trang -->
                                                    <nav aria-label="Page navigation example">
                                                        <ul class="pagination">
                                                            <li class="page-item"><a class="page-link"
                                                                                     th:href="@{/admin/store/invoice-detail/{id}(id=${invoiceId},page=${currentPage - 1}, size=${size})}">Previous</a>
                                                            </li>
                                                            <li class="page-item"
                                                                th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                                                                th:classappend="${i == currentPage} ? 'active'"><a
                                                                    class="page-link"
                                                                    th:href="@{/admin/store/invoice-detail/{id}(id=${invoiceId},page=${i}, size=${size})}">[[${i
                                                                + 1}]]</a></li>
                                                            <li class="page-item"><a class="page-link"
                                                                                     th:href="@{/admin/store/invoice-detail/{id}(id=${invoiceId},page=${currentPage + 1}, size=${size})}">Next</a>
                                                            </li>
                                                        </ul>
                                                    </nav>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                            data-bs-dismiss="modal">Đóng
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div>
                                <span class="me-3" th:text="${formattedDate != null ? formattedDate : ''}"></span>
                                <span class="me-3"
                                      th:text="${infoInvoice != null ? 'ID : ' + infoInvoice.id : ''}"></span>
                                <span class="me-3"
                                      th:text="${infoInvoice != null ? infoInvoice.invoiceTrackingNumber : ''}"></span>
                                <span class="badge rounded-pill bg-info" th:if="${infoInvoice != null}">[[${infoInvoice.status} == 0 ? 'Chưa thanh toán':'Đã thanh toán']]</span>
                            </div>
                        </div>

                        <table class="table" style="margin-bottom: 0px">
                            <thead>
                            <tr>
                                <th>STT</th>
                                <th>Ảnh</th>
                                <th>Tên sản phẩm</th>
                                <th>Số lượng</th>
                                <th>Đơn giá</th>
                                <th>Thành tiền</th>
                                <th>Hành động</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="invoiceDetail,stt : ${listInvoiceDetail}">
                                <td>[[${stt.index+1}]]</td>
                                <td th:if="${invoiceDetail.productDetail.product.images.size() > 0}">
                                    <div class="flex-shrink-0">
                                        <img th:src="${invoiceDetail.productDetail.product.images[0].imageUrl}"
                                             alt="Ảnh sản phẩm" width="35"
                                             class="img-fluid"/>
                                    </div>
                                </td>
                                <td th:if="${invoiceDetail.productDetail.product.images.size() <= 0}">
                                    <div class="flex-shrink-0">
                                        <img src="" alt="Ảnh mặc định" width="35" class="img-fluid"/>
                                    </div>
                                </td>
                                <td>
                                    <div class="flex-lg-grow-1 ms-3">
                                        <h6 class="small mb-0"><a href="#" class="text-reset">[[${invoiceDetail.productDetail.product.name}]]</a>
                                        </h6>
                                        <span class="small">Màu sắc: [[${invoiceDetail.productDetail.color.name}]],</span>
                                        <span class="small">Kích cỡ: [[${invoiceDetail.productDetail.size.name}]]</span>
                                    </div>
                                </td>
                                <form th:action="@{/admin/store/update-quantity}" th:object="${invoiceDetail}"
                                      method="post">
                                    <td>
                                        <center>
                                        <input type="hidden" name="ids" th:value="${invoiceDetail.id}"/>
                                        <input class="form-control" style="width:60px; text-align: center; align-items: center" type="number" name="quantities" th:value="${invoiceDetail.quantity}"
                                               min="1"
                                               onchange="this.form.submit()"/>
                                        </center>
                                    </td>
                                </form>
                                <td>[[${invoiceDetail.productDetail.price}]]</td>
                                <td>[[${invoiceDetail.finalPrice}]]</td>
                                <td>
                                    <a th:href="@{/admin/store/delete-product-from-invoice/{id}(id=${invoiceDetail.id})}"
                                       onclick="return confirm('Bạn có chắc là muốn xoá sản phẩm này khỏi giỏ hàng ?')">
                                        <button class="btn btn-danger">Xoá</button>
                                    </a></td>
                            </tr>

                            </tbody>
                        </table>

                        <span class="me-3"
                              th:text="${infoInvoice != null ? 'Người tạo : ' + infoInvoice.employee.username : ''}"></span>
                    </div>

                </div>
            </div>

            <!-- Card thông tin khách hàng ở bên phải -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header text-center">
                        Thông tin hoá đơn
                    </div>
                    <div class="card-body">
                        <form>
                            <div class="mb-3">
                                <label class="form-label me-2">Khách Hàng</label>
                                <div class="d-flex align-items-center">
                                    <select id="customerSelect" class="form-select">
                                        <option value="">Chọn khách hàng</option>
                                        <option th:each="customer : ${listCustomer}" th:value="${customer.id}"
                                                th:text="${customer.fullname}+' - '+${customer.phone}"></option>
                                    </select>
                                    <button type="button" class="btn btn-primary ms-2" data-bs-toggle="modal"
                                            data-bs-target="#addCustomerModal">+
                                    </button>
                                </div>
                            </div>
                            <!-- Nhập voucher -->
                            <div class="mb-3 row">
                                <label class="form-label">Mã Voucher</label>
                                <div class="col-7 d-flex align-items-center">
                                    <select id="voucherSelect" class="form-select" onchange="updateVoucherPreview()">
                                        <option value="">Chọn voucher</option>
                                        <option th:each="voucher : ${listVoucher}" th:value="${voucher.id}"
                                                th:text="${voucher.code}+' - '+${voucher.name}"
                                                th:data-code="${voucher.code}" th:data-name="${voucher.name}"
                                                th:data-discount="${voucher.discountPercentage}"
                                                th:data-description="${voucher.description}"
                                                th:data-quantity="${voucher.quantity}"
                                                th:data-startdate="${voucher.startDate}"
                                                th:data-enddate="${voucher.endDate}"
                                                th:selected="${infoInvoice != null && infoInvoice.voucher != null && voucher.id == infoInvoice.voucher.id}"></option>
                                    </select>
                                </div>
                                <div class="col-5">
                                    <button type="button" class="btn btn-primary w-100" id="applyVoucherBtn">Áp dụng
                                    </button>
                                </div>
                                <!-- Phần hiển thị preview -->
                                <div class="card-body preview-block" style="display: none">
                                    <div class="voucher-card m-1"
                                         style="width: 100%; height: 130px; border-radius: 10px; background: linear-gradient(135deg, #43a047, #76c893); color: #fff; display: flex; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);">
                                        <div class="voucher-left"
                                             style="flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 10px;">
                                            <div id="previewName" class="voucher-header"
                                                 style="font-size: 16px; font-weight: bold; text-align: center;">
                                                SUMMER SALE
                                            </div>
                                            <div id="previewDiscount" class="discount-amount"
                                                 style="font-size: 28px; font-weight: bold; color: #ffffff;">25%
                                                OFF
                                            </div>
                                        </div>
                                        <div class="voucher-right"
                                             style="flex: 1; padding: 10px; display: flex; flex-direction: column; justify-content: space-around; background-color: #fff; color: #43a047;">
                                            <div id="previewCode" class="voucher-code"
                                                 style="font-size: 16px; font-weight: bold; background: #43a047; color: #fff; padding: 4px 8px; border-radius: 5px; text-align: center;">
                                                GREEN2023
                                            </div>
                                            <div id="previewQuantity" class="voucher-details"
                                                 style="font-size: 12px; color: #777;">Quantity : 50
                                                purchase.
                                            </div>
                                            <div id="previewDescription" class="voucher-details"
                                                 style="font-size: 12px; color: #777;">Get 25% off on your next
                                                order.
                                            </div>
                                            <div id="previewValidity" class="validity"
                                                 style="font-size: 10px; color: #555; text-align: center;">Valid:
                                                01/06/2023 - 30/06/2023
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label me-2">Phương thức thanh toán</label>
                                <div class="d-flex align-items-center">
                                    <select class="form-control flex-grow-1" id="paymentMethod">
                                        <option value="" hidden="hidden">Chọn phương thức thanh toán</option>
                                        <option th:each="payment : ${listPayment}"
                                                th:text="${payment.name}"
                                                th:value="${payment.id}"></option>
                                    </select>
                                </div>

                                <!-- Bảng tính toán tiền mặt -->
                                <div id="cashCalculation" th:data-total-amount="${totalAmount}"
                                     style="display: none; margin-top: 20px;">
                                    <label class="form-label">Bảng tính toán tiền mặt</label>
                                    <div>
                                        <label>Tiền khách đưa:</label>
                                        <input type="number" id="cashGiven" class="form-control"
                                               oninput="calculateChange()">
                                    </div>
                                    <div>
                                        <label>Tiền thối lại:</label>
                                        <span id="changeAmount">0</span>
                                    </div>
                                </div>

                                <!-- Modal hiển thị mã QR và đếm ngược -->
                                <div class="modal fade" id="qrModal" tabindex="-1" aria-labelledby="qrModalLabel"
                                     aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="qrModalLabel">Quét mã thanh toán</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body text-center">
                                                <img style="width: 400px" id="qrImage" th:src="${qrUrl}"
                                                     alt="Mã QR VietQR thanh toán">
                                                <p id="countdownText" class="mt-3">Thời gian còn lại: <span
                                                        id="countdown"></span> giây</p>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                                    Đóng
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table mb-5 mt-3">
                                    <tbody>
                                    <form th:object="${infoInvoice}">
                                        <tr>
                                            <td>Tổng tiền :</td>
                                            <td id="totalPrice" th:if="${infoInvoice != null}" class="text-end"
                                                th:field="*{totalPrice}" th:text="*{totalPrice}"></td>
                                        </tr>
                                        <tr id="discountRow" style="display: none;">
                                            <td>Giảm giá :</td>
                                            <td id="discountAmount" class="text-end"></td>
                                        </tr>
                                        <tr th:if="${infoInvoice != null and infoInvoice.deliverDate != null}">
                                            <td>Phí ship :</td>
                                            <td class="text-end">$ 25</td>
                                        </tr>
                                        <tr class="bg-light">
                                            <th>Thực thu :</th>
                                            <td class="text-end">
                                            <span id="finalPrice" th:if="${infoInvoice != null}" class="fw-bold"
                                                  th:field="*{finalPrice}" th:text="*{finalPrice}">
                                            </span>
                                            </td>
                                        </tr>
                                    </form>
                                </table>
                            </div>
                            <button type="button" class="btn btn-primary w-100" id="scanQrButton">Thanh toán</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="addCustomerModal" tabindex="-1" aria-labelledby="addCustomerModalLabel"
         aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form method="post" th:object="${kh}" th:action="@{/admin/store/add-new-customer}">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <div class="modal-header">
                        <h5 class="modal-title" id="addCustomerModalLabel">Thêm Khách Hàng Mới</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">Tên Khách Hàng</label>
                            <input type="text" hidden="hidden" th:value="${invoiceId}" name="invoiceId">
                            <input type="text" class="form-control" th:field="*{fullname}"
                                   placeholder="Nhập tên khách hàng" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Số Điện Thoại</label>
                            <input type="tel" class="form-control" th:field="*{phone}" placeholder="Nhập số điện thoại"
                                   required>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                        <button type="submit" class="btn btn-primary">Lưu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Đếm ngược thời gian khi mở modal
        let countdownInterval;

        // Lắng nghe sự kiện thay đổi của select phương thức thanh toán
        document.getElementById("paymentMethod").addEventListener("change", function () {
            const paymentMethod = this.value;

            // Kiểm tra nếu chọn "tiền mặt" (ví dụ id của tiền mặt là 1)
            if (paymentMethod === "1") {
                document.getElementById("scanQrButton").addEventListener("click", handleCashPayment);
            } else {
                document.getElementById("scanQrButton").addEventListener("click", handleTransferPayment);
            }
        });

        // Hàm xử lý thanh toán chuyển khoản
        function handleTransferPayment() {
            // Hiển thị modal chuyển khoản
            const qrModal = new bootstrap.Modal(document.getElementById("qrModal"));
            qrModal.show();

            const countdownElement = document.getElementById("countdown");
            let timeLeft = 300; // Đếm ngược từ 300 giây (5 phút)

            countdownElement.innerText = timeLeft;
            countdownInterval = setInterval(function () {
                timeLeft -= 1;
                countdownElement.innerText = timeLeft;

                // Khi đếm ngược đến 15 giây, hiển thị thông báo SweetAlert
                if (timeLeft === 285) { // 300 giây - 15 giây = 285 giây còn lại
                    Swal.fire({
                        icon: 'success',
                        title: 'Thanh toán thành công',
                        text: 'Thanh toán của bạn đã được xác nhận!',
                        confirmButtonText: 'OK',
                        timer: 3000 // SweetAlert sẽ tự động đóng sau 3 giây
                    }).then(() => {
                        // Mở trang PDF trong tab mới sau khi SweetAlert đóng
                        const newTab = window.open('/admin/store/9/pdf', '_blank');
                        if (!newTab || newTab.closed || typeof newTab.closed == 'undefined') {
                            alert("Trình duyệt của bạn đã chặn tab mới. Hãy kiểm tra cài đặt popup!");
                        } else {
                            window.location.href = '/admin/store/index';
                        }
                    });
                }

                // Đóng modal khi hết thời gian
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    qrModal.hide();
                }
            }, 1000);
        }

        // Xóa đếm ngược khi đóng modal
        document.getElementById("qrModal").addEventListener("hidden.bs.modal", function () {
            clearInterval(countdownInterval);
        });

        // Hàm xử lý thanh toán tiền mặt
        function handleCashPayment() {
            Swal.fire({
                icon: 'success',
                title: 'Thanh toán thành công',
                text: 'Thanh toán của bạn đã được xác nhận!',
                confirmButtonText: 'OK',
                timer: 3000 // SweetAlert sẽ tự động đóng sau 3 giây
            }).then(() => {
                // Mở trang PDF trong tab mới sau khi SweetAlert đóng
                const newTab = window.open('/admin/store/9/pdf', '_blank');
                if (!newTab || newTab.closed || typeof newTab.closed == 'undefined') {
                    alert("Trình duyệt của bạn đã chặn tab mới. Hãy kiểm tra cài đặt popup!");
                } else {
                    window.location.href = '/admin/store/index';
                }
            });
        }


        document.getElementById("paymentMethod").addEventListener("change", function () {
            const selectedMethod = this.options[this.selectedIndex].text;
            const cashCalculationDiv = document.getElementById("cashCalculation");

            if (selectedMethod === "Tiền mặt") {  // Tên phương thức là "Tiền mặt"
                cashCalculationDiv.style.display = "block";
            } else {
                cashCalculationDiv.style.display = "none";
            }
        });

        function calculateChange() {
            // Lấy giá trị totalAmount từ thuộc tính data-total-amount
            const cashCalculationDiv = document.getElementById("cashCalculation");
            const finalPriceElement = parseFloat(document.getElementById("finalPrice").innerText || 0);
            const cashGiven = parseFloat(document.getElementById("cashGiven").value || 0);
            const change = cashGiven - finalPriceElement;
            console.log(cashCalculationDiv)
            console.log(finalPriceElement)
            console.log(cashGiven)
            console.log(change)

            // Cập nhật hiển thị tiền thối lại
            document.getElementById("changeAmount").innerText = change >= 0 ? change.toFixed(2) : "0";
        }

        $(document).ready(function () {
            $('#customerSelect').select2({
                placeholder: "Tìm kiếm khách hàng",
                allowClear: true
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            $('#voucherSelect').select2({
                placeholder: "Chọn voucher",
                allowClear: true
            });
        });
        document.addEventListener("DOMContentLoaded", function () {
            updateVoucherPreview(); // Gọi khi trang tải để hiển thị voucher đã có
        });

        function updateVoucherPreview() {
            const select = document.getElementById("voucherSelect");
            const selectedOption = select.options[select.selectedIndex];

            // Lấy phần preview container
            const previewContainer = document.querySelector(".card-body .preview-block");

            // Kiểm tra nếu không chọn voucher nào
            if (!selectedOption || !selectedOption.value) {
                // Ẩn phần preview
                previewContainer.style.display = "none";
                return;
            }

            const totalPriceElement = document.getElementById("totalPrice");
            const discountRow = document.getElementById("discountRow");
            const discountAmountElement = document.getElementById("discountAmount");
            const finalPriceElement = document.getElementById("finalPrice");

            // Lấy tổng tiền từ phần tử tổng tiền
            const totalPrice = parseFloat(totalPriceElement.innerText) || 0;
            const discountPer = parseFloat(selectedOption.getAttribute("data-discount")) || 0;
            const discountAmount = (totalPrice * discountPer) / 100;
            const finalPrice = totalPrice - discountAmount;

            // Hiển thị dòng giảm giá và cập nhật giá trị
            discountRow.style.display = "table-row";
            discountAmountElement.innerText = `${discountAmount.toFixed(2)}`;
            finalPriceElement.innerText = `${finalPrice.toFixed(2)}`;

            // Hiển thị phần preview nếu có lựa chọn
            previewContainer.style.display = "block";

            // Lấy thông tin voucher từ các thuộc tính data
            const name = selectedOption.getAttribute("data-name") || "Voucher";
            const code = selectedOption.getAttribute("data-code") || "CODE";
            const discount = selectedOption.getAttribute("data-discount") || "0";
            const description = selectedOption.getAttribute("data-description") || "Mô tả";
            const quantity = selectedOption.getAttribute("data-quantity") || "0";
            const startDate = selectedOption.getAttribute("data-startdate") || "--";
            const endDate = selectedOption.getAttribute("data-enddate") || "--";

            // Định dạng chuỗi ngày tháng
            const formattedStartDate = startDate ? new Date(startDate).toLocaleDateString() : "--";
            const formattedEndDate = endDate ? new Date(endDate).toLocaleDateString() : "--";

            // Cập nhật nội dung phần preview
            document.getElementById("previewName").innerText = name;
            document.getElementById("previewCode").innerText = code;
            document.getElementById("previewDiscount").innerText = `${discount}% OFF`;
            document.getElementById("previewQuantity").innerText = `Quantity: ${quantity}`;
            document.getElementById("previewDescription").innerText = description;
            document.getElementById("previewValidity").innerText = `Valid: ${formattedStartDate} - ${formattedEndDate}`;
        }
    </script>
    <script src="/admin/store/script.js"></script>
    <script th:if="${errorMessage != null}" th:inline="javascript">
        Swal.fire({
            title: 'Lỗi!',
            text: '/*[[${errorMessage}]]*/',  // Sử dụng cú pháp inline của Thymeleaf
            icon: 'error',
            confirmButtonText: 'OK',
            confirmButtonColor: '#3085d6'
        });
    </script>
    <script>
        // Hàm SweetAlert dùng chung
        function showAlert(title, text, icon = 'info', confirmButtonText = 'OK') {
            Swal.fire({
                title: title,
                text: text,
                icon: icon,
                confirmButtonText: confirmButtonText,
                confirmButtonColor: '#3085d6'
            });
        }

        document.getElementById('showToastButton').addEventListener('click', function (event) {
            // Hiển thị hộp thoại xác nhận
            Swal.fire({
                title: 'Bạn có chắc chắn muốn thêm hóa đơn?',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Đồng ý',
                cancelButtonText: 'Hủy',
                reverseButtons: true
            }).then((result) => {
                if (result.isConfirmed) {
                    // Nếu đồng ý, hiển thị thông báo Toast
                    const Toast = Swal.mixin({
                        toast: true,
                        position: "top-end",
                        showConfirmButton: false,
                        timer: 1500,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.onmouseenter = Swal.stopTimer;
                            toast.onmouseleave = Swal.resumeTimer;
                        }
                    });
                    Toast.fire({
                        icon: "success",
                        title: "Thêm thành công"
                    });

                    // Chờ toast hoàn thành rồi submit form
                    setTimeout(() => {
                        document.getElementById('invoiceForm').submit();
                    }, 1500);
                }
            });
        });

    </script>
</main>
</body>


</html>