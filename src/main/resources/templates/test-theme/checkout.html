<!DOCTYPE html>
<html lang="en" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{/test-theme/template}">
<head>
    <meta charset="UTF-8">
    <title>Shop</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
<main layout:fragment="main">

    <!-- Breadcrumb Begin -->
    <div class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__links">
                        <a href="./index.html"><i class="fa fa-home"></i> Home</a>
                        <span>Shopping cart</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->

    <!-- Checkout Section Begin -->
    <section class="checkout spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h6 class="coupon__link"><span class="icon_tag_alt"></span> <a href="#">Have a coupon?</a> Click
                        here to enter your code.</h6>
                </div>
            </div>
            <form th:action="@{/check-out}" class="checkout__form" method="post">
                <input type="hidden"
                       th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}"/>
                <div class="row">
                    <div class="col-lg-8">
                        <h5>Chi tiết thanh toán</h5>
                        <div class="row" th:if="${invoice != null}">
                            <input type="hidden" name="invId" th:value="${invoice.id}">
                            <div class="col-lg-12">
                                <div class="checkout__form__input">
                                    <p>Họ và tên <span>*</span></p>
                                    <input type="text" th:value="${invoice.customer != null ? invoice.customer.fullname : ''}" required>
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="checkout__form__input">
                                    <p>Quốc gia <span>*</span></p>
                                    <input type="text" name="countryInv" th:value="${invoice.customer != null ? invoice.customer.country : ''}" required>
                                </div>
                                <div class="checkout__form__input">
                                    <p>Địa chỉ <span>*</span></p>
                                    <input type="text" name="addressInv" placeholder="Street Address" th:value="${invoice.customer != null ? invoice.customer.address : ''}" required>
                                </div>
                                <div class="checkout__form__input">
                                    <p>Tỉnh/Thành phố <span>*</span></p>
                                    <select id="province" name="cityInv" required>
                                        <option value="" readonly="">Chọn Tỉnh/Thành phố</option>
                                        <option th:each="province : ${provinces}"
                                                th:selected="${invoice.customer != null && invoice.customer.city == province['code']}"
                                                th:value="${province['code']}"
                                                th:text="${province['name']}">
                                        </option>
                                    </select>
                                </div>
                                <div class="checkout__form__input">
                                    <p>Quận/Huyện <span>*</span></p>
                                    <select id="district" name="districtInv" required>
                                        <option value="" readonly="">Chọn Quận/Huyện</option>
                                    </select>
                                </div>
                                <div class="checkout__form__input">
                                    <p>Xã/Phường <span>*</span></p>
                                    <select id="ward" name="wardInv" required>
                                        <option value="" readonly="">Chọn Xã/Phường</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="checkout__form__input">
                                    <p>Phone <span>*</span></p>
                                    <input type="text" name="phoneInv" th:value="${invoice.customer != null ? invoice.customer.phone : ''}" required>
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="checkout__form__input">
                                    <p>Email <span>*</span></p>
                                    <input type="text" th:value="${invoice.customer != null ? invoice.customer.email : ''}" required>
                                </div>
                            </div>
<!--                            <div class="col-lg-12">-->
<!--                                <div class="checkout__form__checkbox">-->
<!--                                    <label for="acc">-->
<!--                                        Create an acount?-->
<!--                                        <input type="checkbox" id="acc">-->
<!--                                        <span class="checkmark"></span>-->
<!--                                    </label>-->
<!--                                    <p>Create am acount by entering the information below. If you are a returing-->
<!--                                        customer login at the <br/>top of the page</p>-->
<!--                                </div>-->
<!--                                <div class="checkout__form__input">-->
<!--                                    <p>Account Password <span>*</span></p>-->
<!--                                    <input type="text">-->
<!--                                </div>-->
<!--                                <div class="checkout__form__checkbox">-->
<!--                                    <label for="note">-->
<!--                                        Note about your order, e.g, special noe for delivery-->
<!--                                        <input type="checkbox" id="note">-->
<!--                                        <span class="checkmark"></span>-->
<!--                                    </label>-->
<!--                                </div>-->
<!--                                <div class="checkout__form__input">-->
<!--                                    <p>Oder notes <span>*</span></p>-->
<!--                                    <input type="text"-->
<!--                                           placeholder="Note about your order, e.g, special noe for delivery">-->
<!--                                </div>-->
<!--                            </div>-->
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="checkout__order">
                            <h5>Đơn hàng của bạn</h5>
                            <div class="checkout__order__product">
                                <ul>
                                    <li>
                                        <span class="top__text">Sản phẩm</span>
                                        <span class="top__text__right">Thành tiền</span>
                                    </li>
                                    <li th:each="c : ${cartDetails}">[[${c.productDetail.product.name}]] <span>[[${T(com.beehat.service.CurrencyUtil).formatCurrency(c.productDetail.price * c.quantity)}]]</span></li>

                                </ul>
                            </div>
                            <div class="checkout__order__total">
                                <ul>
                                    <li>Subtotal <span>[[${T(com.beehat.service.CurrencyUtil).formatCurrency(invoice.totalPrice)}]]</span></li>
                                    <li>Total <span>[[${T(com.beehat.service.CurrencyUtil).formatCurrency(invoice.totalPrice)}]]</span></li>
                                </ul>
                            </div>
                            <div class="checkout__order__widget">
<!--                                <label for="o-acc">-->
<!--                                    Create an acount?-->
<!--                                    <input type="checkbox" id="o-acc">-->
<!--                                    <span class="checkmark"></span>-->
<!--                                </label>-->
<!--                                <p>Create am acount by entering the information below. If you are a returing customer-->
<!--                                    login at the top of the page.</p>-->
                                <label for="check-payment">
                                    Tiền mặt
                                    <input type="checkbox" id="check-payment" name="paymentInv" value="1">
                                    <span class="checkmark"></span>
                                </label>
                                <label for="paypal">
                                    Mobile banking
                                    <input type="checkbox" id="paypal" name="paymentInv" value="2">
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                            <button type="submit" class="site-btn">Place oder</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </section>
    <!-- Checkout Section End -->

<script>
    $(document).ready(function () {
        // Khi thay đổi tỉnh/thành phố
        $('#province').change(function () {
            const provinceId = $(this).val();
            if (provinceId) {
                $.ajax({
                    url: `/districts?provinceId=${provinceId}`,
                    method: 'GET',
                    success: function (data) {
                        let districtOptions = '<option value="">Chọn Quận/Huyện</option>';
                        data.forEach(district => {
                            districtOptions += `<option value="${district.code}">${district.name}</option>`;
                        });
                        $('#district').html(districtOptions);
                        $('#ward').html('<option value="">Chọn Xã/Phường</option>'); // Reset ward
                    }
                });
            }
        });

        // Khi thay đổi quận/huyện
        $('#district').change(function () {
            const districtId = $(this).val();
            if (districtId) {
                $.ajax({
                    url: `/wards?districtId=${districtId}`,
                    method: 'GET',
                    success: function (data) {
                        let wardOptions = '<option value="">Chọn Xã/Phường</option>';
                        data.forEach(ward => {
                            wardOptions += `<option value="${ward.code}">${ward.name}</option>`;
                        });
                        $('#ward').html(wardOptions);
                    }
                });
            }
        });
    });
</script>
</main>
</body>

</html>